str(coexistance)
ggplot(coexistance)+
geom_point(aes(species, Omega, col = treatment))
ggplot(coexistance)+
geom_point(aes(species, theta, col = treatment))
ggplot(coexistance)+
geom_point(aes(Omega, theta, col = treatment))
ggplot(coexistance)+
geom_point(aes(theta ,Omega , col = treatment))
ggplot(coexistance)+
geom_point(aes(theta ,Omega , col = treatment))+
geom_smooth(aes(theta ,Omega , col = treatment))
ggplot(coexistance)+
geom_point(aes(Omega,theta , col = treatment))+
ggplot(coexistance)+
geom_point(aes(Omega,theta , col = treatment))
ggplot(coexistance)+
geom_point(aes(Omega,theta , col = treatment))
ggplot(coexistance)+
geom_point(aes(species, Omega, col = treatment))
str(coexistance)
head(bioma_long)
head(bioma)
str(coexistance)
######## biomass and coex ##########
data_biomass = full_join(coexistance, bioma, by("treatment", "species"))
######## biomass and coex ##########
data_biomass = full_join(coexistance, bioma, by = c("treatment", "species"))
str(coexistance)
str(bioma)
bioma$species = apply( bioma[,c("species_1", "species_2", "species_3")], 1,
function(x) paste(x[!is.na(x)], collapse = "_"))
str(bioma)
save(bioma, file = "organized_data/bioma.RData")
######## biomass and coex ##########
data_biomass = full_join(coexistance, bioma, by = c("treatment", "species"))
rlang::last_error()
rlang::last_trace()
str(coexistance)
######## biomass and coex ##########
str(coexistance)
str(bioma)
localDir="~/Fac/Cesure2/Plant_species_coexistence/functions_and_coex/"
setwd(localDir)
data_dir = "organized_data"
load(file.path(data_dir,"bioma.RData"))
load(file.path(data_dir,"coexistance.RData"))
load(file.path(data_dir,"cover.RData"))
load(file.path(data_dir,"enzimatic_activity.RData"))
load(file.path(data_dir,"herbivoty_pathogen.RData"))
load(file.path(data_dir,"par_and_height.RData"))
str(bioma)
bioma$species = apply( bioma[,c("species_1", "species_2", "species_3")], 1,
function(x) paste(x[!is.na(x)], collapse = "_"))
bioma$nitrogen = as.character(bioma$nitrogen)
bioma$nitrogen[bioma$nitrogen == "1"] = "nitrogen"
str(bioma)
bioma$nitrogen = as.character(bioma$nitrogen)
names(bioma)[names(bioma) == "treatement"]
names(bioma)[names(bioma) == "treatement"]= "treatment"
names(cover)[names(cover) == "treatement"]
names(cover)[names(cover) == "treatement"]= "treatment"
names(enz_act)[names(enz_act) == "treatement"]= "treatment"
names(herbi)[names(herbi) == "treatement"]= "treatment"
names(par_height)[names(par_height) == "treatement"]= "treatment"
save(enz_act,file = "organized_data/enzimatic_activity.RData")
save(par_height,file = "organized_data/par_and_height.RData")
save(herbi,file = "organized_data/herbivoty_pathogen.RData")
save(cover,file = "organized_data/cover.RData")
save(bioma,file = "organized_data/bioma.RData")
localDir="~/Fac/Cesure2/Plant_species_coexistence/functions_and_coex/"
setwd(localDir)
data_dir = "organized_data"
load(file.path(data_dir,"bioma.RData"))
load(file.path(data_dir,"coexistance.RData"))
load(file.path(data_dir,"cover.RData"))
########## OVERVIEW BIOMASSE DATA ##########
head(bioma)
str(bioma)
bioma_long = bioma %>%
pivot_longer(cols = species_1:species_3, names_to = "sp_number", values_to = "specie" )
head(bioma_long)
ggplot(bioma_long)+
geom_point(aes(plot_ID, biomass, col = treatement))+
facet_wrap(~type)
ggplot(subset(bioma_long, bioma_long$type == "triplet"))+
geom_boxplot(aes(specie, biomass))+
facet_wrap(~treatement)
ggplot(bioma_long)+
geom_point(aes(plot_ID, biomass, col = treatement))+
facet_wrap(~type)
str(bioma_long)
mod_sp_effect = lm(data = bioma_long, biomass ~ specie)
par(mfrow = c(2, 2))
plot(mod_sp_effect)
ggplot(bioma_long)+
geom_point(aes(plot_ID, biomass, col = treatment))+
facet_wrap(~type)
ggplot(subset(bioma_long, bioma_long$type == "triplet"))+
geom_boxplot(aes(specie, biomass))+
facet_wrap(~treatment)
ggplot(bioma_long)+
geom_point(aes(plot_ID, biomass, col = treatment))+
facet_wrap(~type)
str(bioma_long)
mod_sp_effect = lm(data = bioma_long, biomass ~ specie)
par(mfrow = c(2, 2))
plot(mod_sp_effect)
par(mfrow = c(1, 1))
summary(mod_sp_effect)
hist(mod_sp_effect$residuals)
str(coexistance)
coexistance
ggplot(coexistance)+
geom_point(aes(species, Omega, col = treatment))
ggplot(coexistance)+
geom_point(aes(species, theta, col = treatment))
ggplot(coexistance)+
geom_point(aes(Omega,theta , col = treatment))
######## biomass and coex ##########
str(coexistance)
str(bioma)
data_biomass = full_join(coexistance, bioma, by = c("treatment", "species"))
str(data_biomass)
ggplot()
ggplot(data_biomass)+
geom_point(aes(biomass, Omega))
ggplot(data_biomass)+
geom_boxplot(aes(treatment, biomass))
ggplot(data_biomass)+
geom_boxplot(aes(Omega, biomass))+
facet_wrap(~treatment)
ggplot(data_biomass)+
geom_geom_point(aes(Omega, biomass))+
facet_wrap(~treatment)
ggplot(data_biomass)+
geom_point(aes(Omega, biomass))+
facet_wrap(~treatment)
ggplot(data_biomass)+
geom_point(aes(Omega, biomass, col = treatment))+
facet_wrap(~)
ggplot(data_biomass)+
geom_point(aes(Omega, biomass, col = treatment))+
ggplot(data_biomass)+
geom_point(aes(Omega, biomass, col = treatment))
ggplot(data_biomass)+
geom_point(aes(Omega, biomass, col = treatment))
ggplot(data_biomass)+
geom_point(aes(theta, biomass, col = treatment))
ggplot(data_biomass)+
geom_point(aes(Omega, biomass, col = treatment))+
scale_x_log10()
str(cover)
over_long = cover %>%
pivot_longer(cols = Be:legumes, names_to = "species_cover", values_to = "perc_cover")
ggplot(cover_long)+
geom_point(aes(species_cover,perc_cover))
View(over_long)
rm(over_long)
cover_long = cover %>%
pivot_longer(cols = Be:legumes, names_to = "species_cover", values_to = "perc_cover")
ggplot(cover_long)+
geom_point(aes(species_cover,perc_cover))
ggplot(cover_long)+
geom_boxplot(aes(species_cover,perc_cover))
str(cover_long)
str(cover)
str(cover_long)
mod_cover = lm(data = cover_long,perc_cover ~ species_cover)
par(mfrow = c(2, 2))
plot(mod_cover)
par(mfrow = c(1, 1))
summary(mod_cover)
ggplot(cover_long)+
geom_boxplot(aes(species_cover,perc_cover))
coef(mod_cover)
summary(mod_cover)
install.packages("sjPlot")
library(sjPlot)
browseVignettes("sjPlot")
plot_model(mod_cover)
plot_model(mod_cover,show.values = TRUE, value.offset = .3)
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE)
coef(mod_cover)
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE
transform = NULL)
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE,
transform = NULL)
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE
type = "slope")
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE,
type = "slope")
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE)
coef(mod_cover)
names(cover)
mod_cover2 = lm(data = cover, perc_cover ~ Be + Cb + Dc + Fr + Hl + Lp + Pg + Pm +
Pt + Ra + Sp + To +grasses + herbs + legumes)
cover
mod_cover = lm(data = cover_long,perc_cover ~ species_cover * treatment)
par(mfrow = c(2, 2))
plot(mod_cover)
par(mfrow = c(1, 1))
coef(mod_cover)
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE)
plot(mod_cover, type = "int")
plot(mod_cover, type = "int", mdrt.values = "meansd")
plot(mod_cover)
plot_model(mod_cover)
mod_cover = lm(data = cover_long,perc_cover ~ species_cover)
par(mfrow = c(2, 2))
plot(mod_cover)
par(mfrow = c(1, 1))
summary(mod_cover)
coef(mod_cover)
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE)
ggplot(cover_long)+
geom_boxplot(aes(treatment,perc_cover))
ggplot(cover_long)+
geom_boxplot(aes(species_cover,perc_cover))
str(cover)
ggplot(cover_long)+
geom_boxplot(aes(species_cover,perc_cover, col=type))
ggplot(cover_long)+
geom_boxplot(aes(species_cover,perc_cover, col=type))+
facet_wrap(~treatment)
ggplot(cover_long)+
geom_boxplot(aes(treatment,perc_cover, col=type))
geom_pointt(aes(treatment,perc_cover, col=type))
geom_point(aes(treatment,perc_cover, col=type))
ggplot(cover_long)+
geom_boxplot(aes(treatment,perc_cover, col=type))+
geom_point(aes(treatment,perc_cover, col=type))
ggplot(cover_long)+
geom_boxplot(aes(treatment,perc_cover, col=type))+
geom_point(aes(treatment,perc_cover, col=type))+
scale_y_log10
ggplot(cover_long)+
geom_boxplot(aes(treatment,perc_cover, col=type))+
geom_point(aes(treatment,perc_cover, col=type))+
scale_y_log10()
par(mfrow = c(2, 2))
plot(mod_cover)
par(mfrow = c(1, 1))
ggplot(cover_long)+
geom_boxplot(aes(treatment,perc_cover, col=type))+
geom_point(aes(treatment,perc_cover, col=type))
ggplot(cover_long)+
geom_boxplot(aes(species_cover,perc_cover))
str(cover_long)
cover_long = cover %>%
pivot_longer(cols = Be:legumes, names_to = "specie", values_to = "perc_cover")
cover_long = cover %>%
pivot_longer(cols = Be:legumes, names_to = "specie_for_cover", values_to = "perc_cover")
cover_long$species == c("grasses, herbs,legumes")
cover_long$species %in% c("grasses, herbs,legumes")
cover_long$specie_for_cover %in% c("grasses, herbs,legumes")
cover_long$specie_for_cover
cover_long$specie_for_cover %in% c("grasses", "herbs","legumes")
-cover_long$specie_for_cover %in% c("grasses", "herbs","legumes")
-c(cover_long$specie_for_cover %in% c("grasses", "herbs","legumes"))
cover_long$specie_for_cover  %in% !c("grasses", "herbs","legumes")
cover_long$specie_for_cover  %!in% c("grasses", "herbs","legumes")
cover_long[cover_long$specie_for_cover  %in% c("grasses", "herbs","legumes"),]
cover_long[cover_long$specie_for_cover  %in% c("grasses", "herbs","legumes"),]
cover_long[cover_long$specie_for_cover  %in% c("grasses", "herbs","legumes"),]
cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
mod_cover = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ specie_for_cover)
c("grasses", "herbs","legumes")))+
ggplot(cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),])+
geom_boxplot(aes(treatment,perc_cover, col=type))+
geom_point(aes(treatment,perc_cover, col=type))
par(mfrow = c(2, 2))
plot(mod_cover)
par(mfrow = c(1, 1))
hist(mod_cover$residuals)
plot_model(mod_cover,show.values = TRUE, value.offset = .3, sort.est = TRUE)
summary(mod_cover)
ggplot(cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),])+
geom_boxplot(aes(treatment,perc_cover, col=type))+
geom_point(aes(treatment,perc_cover, col=type))
mod_cover2 = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ specie_for_cover * treatment)
par(mfrow = c(2, 2))
plot(mod_cover2)
par(mfrow = c(1, 1))
hist(mod_cover2$residuals)
summary(mod_cover2)
mod_cover2 = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ type * treatment)
par(mfrow = c(2, 2))
plot(mod_cover2)
par(mfrow = c(1, 1))
hist(mod_cover2$residuals)
summary(mod_cover2)
coef(mod_cover2)
ggplot(cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),])+
geom_boxplot(aes(treatment,perc_cover, col=type))+
geom_point(aes(treatment,perc_cover, col=type))
mod_cover2 = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ type + treatment)
par(mfrow = c(2, 2))
plot(mod_cover2)
par(mfrow = c(1, 1))
hist(mod_cover2$residuals)
summary(mod_cover2)
ggplot(cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),])+
geom_boxplot(aes(treatment,perc_cover, col=type))+
geom_point(aes(treatment,perc_cover, col=type))
mod_cover2 = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ type * treatment)
summary(mod_cover2)
cover_long$type
tail(cover_long$type)
mod_cover2 = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ treatment * type )
summary(mod_cover2)
str(cover_long)
as.factor(cover_long$treatment)
cover_long$treatment =  as.factor(cover_long$treatment)
mod_cover2 = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ treatment * type )
summary(mod_cover2)
str(cover_long)
cover_long$type =  as.factor(cover_long$type)
mod_cover2 = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ treatment * type )
summary(mod_cover2)
as.character(cover_long$treatment)
cover_long$treatment =  as.character(cover_long$treatment)
cover_long$type =  as.character(cover_long$type)
### DO the treatment interact have more impact on mon than on triplet on the
# the percentage cover ?
mod_cover2 = lm(data = cover_long[!(cover_long$specie_for_cover  %in%
c("grasses", "herbs","legumes")),]
,perc_cover ~ treatment * type +type )
summary(mod_cover2)
as.numeric(cover_long$plot_ID)
max(as.numeric(cover_long$plot_ID))
n_plot=1
cover_long[,cover_long$plot_ID==n_plot & treatment == "control"]
cover_long[,cover_long$plot_ID==n_plot & cover_long$treatment == "control"]
cover_long$plot_ID==n_plot
cover_long$plot_ID==n_plot & cover_long$treatment == "control"
cover_long[,cover_long$plot_ID==n_plot & cover_long$treatment == "control"]
cover_long
cover_long[cover_long$plot_ID==n_plot & cover_long$treatment == "control",]
tail(cover_long)
control = cover_long[cover_long$plot_ID==60 & cover_long$treatment == "control",]
sp_vec = c(control$species1,control$species2,control$species3)
sp_vec
control$species1
control = cover_long[cover_long$plot_ID==60 & cover_long$treatment == "control",]
control
control$species_1
sp_vec = c(control$species_1[1],control$species_2[1],control$species_3[1])
sp_vec
str(cover)
str(cover_long)
sp_vec = c(cover$species_1, cover$species_2, cover$species_3)
sp_vec
cover$species_1
cover[cover$species_1[1],]
cover[,cover$species_1[1]]
48*2
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
cover[,sp_vec]
cover[n_plot,sp_vec]
cover_main_sp = matrix(ncol = 3, nrow=48*2)
cover_main_sp[,n_plot]
cover_main_sp[n_plot,]
cover[n_plot,sp_vec]
cover_main_sp = matrix(ncol = 3, nrow=48*2)
for (n_plot in 1:96){
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
cover_main_sp[n_plot,] = cover[n_plot,sp_vec]
}
cover_main_sp
cover[n_plot,sp_vec]
as.vector(cover[n_plot,sp_vec])
cover_main_sp[n_plot,] = as.vector(cover[n_plot,sp_vec])
cover_main_sp = matrix(ncol = 3, nrow=48*2)
for (n_plot in 1:96){
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
cover_main_sp[n_plot,] = as.vector(cover[n_plot,sp_vec])
}
cover_main_sp = matrix(ncol = 3, nrow=48*2)
for (n_plot in 1:96){
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
cover_main_sp[n_plot,] = as.matrix(cover[n_plot,sp_vec])
}
cover_main_sp
var(cover_main_sp)
var(as.matrix(cover[n_plot,sp_vec]))
cover[n_plot,sp_vec]
var(as.matrix(cover[n_plot,sp_vec]))
sd(as.matrix(cover[n_plot,sp_vec]))
sd(as.matrix(cover[n_plot,sp_vec]))**2
sqrt(sd(as.matrix(cover[n_plot,sp_vec])))
sd(cover_main_sp)
n_plot=60
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
sqrt(sd(as.matrix(cover[n_plot,sp_vec])))
cover[n_plot,sp_vec]
cover$species_1
cover$species_2
sp_vec
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
cover[n_plot,sp_vec]
n_plot
sp_vec
sp_vec
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
cover$species_3[n_plot]
n_plot
cover$species_3
n_plot=120
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
sd(as.matrix(cover[n_plot,sp_vec]))
sd(as.matrix(cover[n_plot,sp_vec]))
as.matrix(cover[n_plot,sp_vec]
as.matrix(cover[n_plot,sp_vec])
as.matrix(cover[n_plot,sp_vec])
as.matrix(cover[n_plot,sp_vec])
as.matrix(cover[n_plot,sp_vec])
sp_vec
sp_vec
sp_vec[!is.na(sp_vec)]
sp_vec = sp_vec[!is.na(sp_vec)]
as.matrix(cover[n_plot,sp_vec])
sd(as.matrix(cover[n_plot,sp_vec]))
CWV <- function(cover){
### variance per plot between the 3 sp
var_per_plot =c()
n_plot=120
for (n_plot in 1:96){
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
sp_vec = sp_vec[!is.na(sp_vec)]
var_per_plot = append(var_per_plot, sqrt(sd(as.matrix(cover[n_plot,sp_vec]))))
}
cover$var_per_plot = var_per_plot
return(cover)
# for(n_plot in 1:max(as.numeric(cover_long$plot_ID))){
#   cover_c = cover_long[cover_long$plot_ID == n_plot & cover_long$treatment == "control",]
#   sp_vec = c(control$species_1[1],control$species_2[1],control$species_3[1])
#   var_cover_c = var(cover_c$perc_cover, )
#   }
}
CWV(cover)
nrwo(cover)
nrwo(cover)
nrow(cover)
CWV <- function(cover){
### variance per plot between the 3 sp
var_per_plot =c()
for (n_plot in 1:nrow(cover)){
sp_vec = c(cover$species_1[n_plot], cover$species_2[n_plot], cover$species_3[n_plot])
sp_vec = sp_vec[!is.na(sp_vec)]
var_per_plot = append(var_per_plot, sqrt(sd(as.matrix(cover[n_plot,sp_vec]))))
}
cover$var_per_plot = var_per_plot
return(cover)
# for(n_plot in 1:max(as.numeric(cover_long$plot_ID))){
#   cover_c = cover_long[cover_long$plot_ID == n_plot & cover_long$treatment == "control",]
#   sp_vec = c(control$species_1[1],control$species_2[1],control$species_3[1])
#   var_cover_c = var(cover_c$perc_cover, )
#   }
}
CWV(cover)
test<-CWV(cover)
tail(test)
cover<-CWV(cover)
cover
tail(cover)
cover_long = cover %>%
pivot_longer(cols = Be:legumes, names_to = "specie_for_cover", values_to = "perc_cover")
str(cover_long)
ggplot(cover_long)+
geom_point(aes(species,var_per_plot, col =treatment))+
ggplot(cover_long)+
geom_point(aes(species,var_per_plot, col =treatment))
ggplot(cover_long)+
geom_point(aes(species,var_per_plot, col =treatment))
ggplot(cover_long)+
geom_point(aes(species_for_cover,var_per_plot, col =treatment))
ggplot(cover_long)+
geom_point(aes(specie_for_cover,var_per_plot, col =treatment))
ggplot(cover_long)+
geom_boxplot(aes(specie_for_cover,var_per_plot, col =treatment))
cover_long
str(cover_long)
cover_long[cover_long$specie_for_cover %in% c(cover_long$species_1,
cover_long$species_2,
cover_long$species_3),]
cover_long$specie_for_cover
cover_long$species_1
ggplot(cover)+
geom_boxplot(aes(specie_for_cover,var_per_plot, col =treatment))
cover
